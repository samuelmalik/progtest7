#include <ctype.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int readNumbers(char *input) {
    if (scanf("%13s", input) != 1) return 1;
    const unsigned long long len = strlen(input);
    if (len > 12) return 1;
    for (unsigned long long i = 0; i<len; i++) {
        if (!isdigit(input[i])) return 1;
    }
    return 0;
}

int readResult(int *result, char* requestType) {
    char c;
    int res = scanf(" %c %d%c",requestType, result,&c);
    //printf("C: \"%c\"\n", c);
    if (res == EOF) return -1;
    if (res != 3 || (*requestType!='?' && *requestType!='#') || c!='\n') return 1;
    return 0;
}

int calculateString(char *str) {

    printf("String is: %s\n", str);
    unsigned long long len = strlen(str);

    int sum = 0;
    int currSign = 0, nextSign = 0;

    // vypocet
    for (int i=0; i<len; i++) {
        // ak narazim na zna ktory nie je krat
        if (str[i] == '+' || str[i] == '-') {
            nextSign = i;
            while (isdigit(str[++nextSign]));
            // pozrieme ci je next znak krat
            if (str[nextSign]=='*') {
                int Msum = 1;
                printf("Zaciatok nasobenia%d\n", currSign);
                printf("Dalsi znak:%d\n", nextSign);

                Msum *= atoi(str + currSign);
                printf("Clen nasobenia: %d\n", atoi(str + currSign));
                currSign = nextSign+1;

                while (str[++nextSign]!='+'&&str[nextSign]!='-') {
                    if (str[nextSign]=='*') {
                        Msum *= atoi(str + currSign);
                        printf("Clen nasobenia: %d\n", atoi(str + currSign));
                        //printf("Indec nasobenia: %d\n", currSign);
                        currSign = nextSign+1;
                    }
                }
                Msum *= atoi(str + currSign);
                printf("Clen nasobenia: %d\n", atoi(str + currSign));
                currSign = nextSign;

                printf("Vysledok nasobenia: %d\n", Msum);
                sum += Msum;
            } else {
                // scitanie
                sum += atoi(str+currSign);
                printf("Scitavam: %d ", atoi(str+currSign));
                currSign = nextSign;
            }
        }

    }

    printf("\nSum is %d\n", sum);
    return 0;
}

void findAllCombinations(char *beginning, char *rest) {
    if (strlen(rest) == 2) {
        char final[25];
        unsigned long finLen = strlen(beginning);
        strcpy(final, beginning);
        final[finLen] = rest[0];
        final[finLen + 2] = rest[1];
        final[finLen + 3] = '\0';

        //printf("\nPrinting new way:\n");

        final[finLen + 1] = '+';
        printf("%s\n", final);

        final[finLen + 1] = '-';
        printf("%s\n", final);

        final[finLen + 1] = '*';
        printf("%s\n", final);

        final[finLen + 1] = rest[1];
        final[finLen + 2] = '\0';
        printf("%s\n", final);

        //printf("\nPrinting old way:\n");
        //printf("%s%c+%c\n", beginning, rest[0], rest[1]);
        //printf("%s%c-%c\n", beginning, rest[0], rest[1]);
        //printf("%s%c*%c\n", beginning, rest[0], rest[1]);
        //printf("%s%c%c\n", beginning, rest[0], rest[1]);
    } else {
        char tmp[25];
        unsigned long begLen = strlen(beginning);

        strcpy(tmp, beginning);
        tmp[begLen] = rest[0];
        tmp[begLen+1] = '+';
        tmp[begLen+2] = '\0';
        findAllCombinations(tmp, rest+1);

        strcpy(tmp, beginning);
        tmp[begLen] = rest[0];
        tmp[begLen+1] = '-';
        tmp[begLen+2] = '\0';
        findAllCombinations(tmp, rest+1);

        strcpy(tmp, beginning);
        tmp[begLen] = rest[0];
        tmp[begLen+1] = '*';
        tmp[begLen+2] = '\0';
        findAllCombinations(tmp, rest+1);

        strcpy(tmp, beginning);
        tmp[begLen] = rest[0];
        //tmp[begLen+1] = '_';
        tmp[begLen+1] = '\0';
        findAllCombinations(tmp, rest+1);

    }
};

int main(void) {

    calculateString("+23*45-6-7*12*3");
    // // premenne
    // char requestType, input[14];
    // int result;
    //
    // // Nacitanie cislic
    // printf("Cislice:\n");
    // if (readNumbers(input)) {
    //     printf("Nespravny vstup.");
    //     return 1;
    // }
    //
    // // Nacitanie a spracovanie problemov
    // printf("Problemy:\n");
    // int scanRes;
    // while ((scanRes = readResult(&result, &requestType))==0) {
    //     // Debug vypis
    //     //printf("===========\nZadane cisla %s\n", input);
    //     //printf("Vysledok %d\n", result);
    //     //printf("Typ: %c\n\n", requestType);
    //
    //     // Funkcia na spracovanie vstupov
    //     char test[2]="";
    //     findAllCombinations(test, input);
    // }
    // if (scanRes != -1) {
    //     printf("Nespravny vstup.");
    //     return 1;
    // }
    return 0;
}
